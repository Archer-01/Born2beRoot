#!/bin/bash

#     _             _     _ _            _
#    / \   _ __ ___| |__ (_) |_ ___  ___| |_ _   _ _ __ ___
#   / _ \ | '__/ __| '_ \| | __/ _ \/ __| __| | | | '__/ _ \
#  / ___ \| | | (__| | | | | ||  __/ (__| |_| |_| | | |  __/
# /_/   \_\_|  \___|_| |_|_|\__\___|\___|\__|\__,_|_|  \___|
ARCH=`uname -a`
echo "#Architecture: ${ARCH}"

#   ____ ____  _   _   ___        __
#  / ___|  _ \| | | | |_ _|_ __  / _| ___
# | |   | |_) | | | |  | || '_ \| |_ / _ \
# | |___|  __/| |_| |  | || | | |  _| (_) |
#  \____|_|    \___/  |___|_| |_|_|  \___/
CPUs=`lscpu | grep "^CPU(s)" | awk -F : '{print $2}' | tr -d ' '`
vCPUs=`grep "cpu cores" /proc/cpuinfo | awk -F : '{print $2}' | tr -d ' '`
echo "#CPU physical : ${CPUs}"
echo "#vCPU : ${vCPUs}"

#  __  __                                   ___        __
# |  \/  | ___ _ __ ___   ___  _ __ _   _  |_ _|_ __  / _| ___
# | |\/| |/ _ \ '_ ` _ \ / _ \| '__| | | |  | || '_ \| |_ / _ \
# | |  | |  __/ | | | | | (_) | |  | |_| |  | || | | |  _| (_) |
# |_|  |_|\___|_| |_| |_|\___/|_|   \__, | |___|_| |_|_|  \___/
#                                   |___/
MEM_TOTAL=`free --mega | grep "^Mem" | awk -F ' ' '{print $2}'`
MEM_USED=`free --mega | grep "^Mem" | awk -F ' ' '{print $3}'`
MEM_PCT=`bc <<< "scale=2; ($MEM_USED * 100) / $MEM_TOTAL"`
echo "#Memory Usage: ${MEM_USED}/${MEM_TOTAL}MB (${MEM_PCT}%)"

#  ____  _     _      ___        __
# |  _ \(_)___| | __ |_ _|_ __  / _| ___
# | | | | / __| |/ /  | || '_ \| |_ / _ \
# | |_| | \__ \   <   | || | | |  _| (_) |
# |____/|_|___/_|\_\ |___|_| |_|_|  \___/
DISK_USED=`df -h / | tail -n 1 | awk '{printf "%d", $3}'`
DISK_TOTAL=`df -h / | tail -n 1 | awk '{print $2}'`
DISK_PCT=`df -h / | tail -n 1 | awk '{print $5}'`
echo "#Disk Usage: ${DISK_USED}/${DISK_TOTAL} ($DISK_PCT)"

#   ____ ____  _   _   _                    _
#  / ___|  _ \| | | | | |    ___   __ _  __| |
# | |   | |_) | | | | | |   / _ \ / _` |/ _` |
# | |___|  __/| |_| | | |__| (_) | (_| | (_| |
#  \____|_|    \___/  |_____\___/ \__,_|\__,_|
CPU_LOAD=`top -bn1 | grep "^%Cpu(s)" | awk '{print $2}'`
echo "#CPU load: ${CPU_LOAD}%"

#  _              _     ____              _     _____ _
# | |    __ _ ___| |_  | __ )  ___   ___ | |_  |_   _(_)_ __ ___   ___
# | |   / _` / __| __| |  _ \ / _ \ / _ \| __|   | | | | '_ ` _ \ / _ \
# | |__| (_| \__ \ |_  | |_) | (_) | (_) | |_    | | | | | | | | |  __/
# |_____\__,_|___/\__| |____/ \___/ \___/ \__|   |_| |_|_| |_| |_|\___|
LAST_BOOT=`who -b | awk '{ printf "%s %s %s", $3, $4, $5 }'`
LAST_BOOT_FORMATTED=`date -d "${LAST_BOOT}" "+%Y-%m-%d %H:%M"`
echo "#Last boot: ${LAST_BOOT_FORMATTED}"

#  _ __     ____  __   _   _
# | |\ \   / /  \/  | | | | |___  __ _  __ _  ___
# | | \ \ / /| |\/| | | | | / __|/ _` |/ _` |/ _ \
# | |__\ V / | |  | | | |_| \__ \ (_| | (_| |  __/
# |_____\_/  |_|  |_|  \___/|___/\__,_|\__, |\___|
#                                      |___/
echo -n "#LVM use: "
lsblk | grep "lvm" > "/dev/null" 2>&1
if [ "$?" -eq "0" ]; then
	echo "yes"
else
	echo "no"
fi

#  _____ ____ ____     ____                            _   _
# |_   _/ ___|  _ \   / ___|___  _ __  _ __   ___  ___| |_(_) ___  _ __  ___
#   | || |   | |_) | | |   / _ \| '_ \| '_ \ / _ \/ __| __| |/ _ \| '_ \/ __|
#   | || |___|  __/  | |__| (_) | | | | | | |  __/ (__| |_| | (_) | | | \__ \
#   |_| \____|_|      \____\___/|_| |_|_| |_|\___|\___|\__|_|\___/|_| |_|___/
TCP_CONN=`netstat | grep -E "(^tcp)*(ESTABLISHED$)" | wc -l`
echo "#Connexions TCP : ${TCP_CONN} ESTABLISHED"

#  _   _                 _                _          ____                  _
# | | | |___  ___ _ __  | |    ___   __ _(_)_ __    / ___|___  _   _ _ __ | |_
# | | | / __|/ _ \ '__| | |   / _ \ / _` | | '_ \  | |   / _ \| | | | '_ \| __|
# | |_| \__ \  __/ |    | |__| (_) | (_| | | | | | | |__| (_) | |_| | | | | |_
#  \___/|___/\___|_|    |_____\___/ \__, |_|_| |_|  \____\___/ \__,_|_| |_|\__|
#                                   |___/
USER_COUNT=`who | awk '{print $1}' | sort -u | wc -l`
echo "#User log: ${USER_COUNT}"

#  _   _      _                      _      ___        __
# | \ | | ___| |___      _____  _ __| | __ |_ _|_ __  / _| ___
# |  \| |/ _ \ __\ \ /\ / / _ \| '__| |/ /  | || '_ \| |_ / _ \
# | |\  |  __/ |_ \ V  V / (_) | |  |   <   | || | | |  _| (_) |
# |_| \_|\___|\__| \_/\_/ \___/|_|  |_|\_\ |___|_| |_|_|  \___/
IP_ADDR=`hostname -I`
INTERFACE=`ip route show default | awk '{print $5}'`
MAC_ADDR=`cat /sys/class/net/${INTERFACE}/address`
echo "#Network: IP ${IP_ADDR} (${MAC_ADDR})"

#  ____            _          ____                  _
# / ___| _   _  __| | ___    / ___|___  _   _ _ __ | |_
# \___ \| | | |/ _` |/ _ \  | |   / _ \| | | | '_ \| __|
#  ___) | |_| | (_| | (_) | | |__| (_) | |_| | | | | |_
# |____/ \__,_|\__,_|\___/   \____\___/ \__,_|_| |_|\__|
SUDO_CMD_COUNT=`wc -l /var/log/sudo/sudo | awk '{print $1}'`
echo "#Sudo : ${SUDO_CMD_COUNT} cmd"